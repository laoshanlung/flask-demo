define(["underscore.custom","marionette.custom","text!templates/common/markdown_editor.html","vendors/codemirror","vendors/marked","vendors/highlight"],function(e,t,n,r,i){var s=t.ItemView.extend({template:function(t){return e.template(n,t)},theme:"blackboard",height:"450px",width:"100%",showToolbar:!0,lineNumbers:!0,events:{"click .js-editor-control button":"onChangeMode","click .js-change-theme":"onChangeTheme"},ui:{editor:".js-editor",control:".js-editor-control",preview:".js-editor-preview"},onRender:function(){var e=this;this.$el.css("min-height",t.getOption(this,"height")),this.$el.width(t.getOption(this,"width"));var n=r(this.ui.editor[0],{indentUnit:2,indentWithTabs:!1,mode:"markdown",lineNumbers:t.getOption(this,"lineNumbers")});n.setOption("theme",t.getOption(this,"theme")),n.on("change",function(t,n){e.triggerMethod("change",n)}),this.codemirror=n;var i=t.getOption(this,"showToolbar");i||this.ui.control.remove(),this.adjustSize(),$(window).resize(function(){clearTimeout($(this).data(e.cid)),$(this).data(e.cid,setTimeout(function(){e.adjustSize()},300))})},onChangeTheme:function(e){var t=$(e.currentTarget),n=t.data("theme");this.codemirror.setOption("theme",n),e.preventDefault()},onChangeMode:function(e){var t=$(e.currentTarget),n=t.data("mode");n&&(this.ui.control.find(".active").removeClass("active"),t.addClass("active"));switch(n){case"markdown":this.ui.preview.hide(),this.ui.editor.show();break;case"preview":this.ui.editor.hide(),this.triggerMethod("preview");break;default:}},onPreview:function(){var e=this.codemirror.getValue(),t=i(e,{renderer:i.getRenderer("article")});this.ui.preview.html(t),this.ui.preview.show()},getValue:function(){return this.codemirror.getValue()},setValue:function(e){return this.codemirror.setValue(e),this},show:function(){this.$el.show()},hide:function(){this.$el.hide()},adjustSize:function(){this.codemirror.setSize(this.ui.editor.width(),this.$el.height()-this.ui.control.height())}});return s});