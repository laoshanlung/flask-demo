define(["backbone.custom","marionette.custom","models/comment","views/common/comment","views/common/load_more","views/common/markdown_editor"],function(e,t,n,r,i,s){var o=t.ItemView.extend({template:"#comment-section-template",refKey:null,events:{"click .js-send":"onSend","click .js-refresh":"onClickRefresh"},ui:{commentForm:".js-comment-form",commentList:".js-comment-list",commentCount:".js-comment-count"},initialize:function(){},onRender:function(){var e=this;refKey=t.getOption(this,"refKey"),this.comment=new n,this.comment.set(refKey,this.model.id);var o={};o[refKey]="id",this.commentsView=new i({model:this.model,collection:this.model.get("comments"),el:this.ui.commentList,itemView:r,modelData:o}),this.listenTo(this.commentsView,"fetch",function(t){e.model.set("comment_count",t.pagination.total)}),this.markdownEditor=new s({el:this.ui.commentForm,model:this.comment,attribute:"content",showToolbar:!1,lineNumbers:!1,height:"200px"}),this.markdownEditor.render(),this.commentsView.render()},onSend:function(e){var t=this,n=$(e.currentTarget);n.bsbutton("loading"),this.comment.save().complete(function(){n.bsbutton("reset")}).success(function(){t.markdownEditor.setValue(""),t.comment.id=void 0,t.onClickRefresh()})},onClickRefresh:function(e){this.commentsView.triggerMethod("refresh")}});return o});