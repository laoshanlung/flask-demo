define(["marionette.custom","forms/article_display"],function(e,t){var n=e.ItemView.extend({template:"#article-template",className:"article preview",events:{"click .js-vote-up":"onVoteUp","click .js-vote-down":"onVoteDown"},initialize:function(){this.form=new t({model:this.model})},ui:{tags:".js-tags",title:".js-title",content:".js-content",author:".js-author",sidebar:".js-sidebar",votePoints:".js-vote-points",voteUp:".js-vote-up",voteDown:".js-vote-down",commentCount:".js-comment-count"},serializeData:function(){return{model:this.model,form:this.form}},onRender:function(){var e=this;this.form.buildControl("title",this.ui.title),this.form.buildControl("content",this.ui.content),this.form.buildControl("user.name",this.ui.author),this.form.buildControl("tags",this.ui.tags),this.form.buildControl("points",this.ui.votePoints),this.form.buildControl("comment_count",this.ui.commentCount)},onVoteUp:function(e){var t=$(e.currentTarget);this._vote(!0,t)},onVoteDown:function(e){var t=$(e.currentTarget);this._vote(!1,t)},_vote:function(e,t){var n=t.hasClass("voted");this.$(".voted").removeClass("voted"),n?this.model.unvote().success(function(){}):this.model.vote(e).success(function(){t.addClass("voted")})}});return n});