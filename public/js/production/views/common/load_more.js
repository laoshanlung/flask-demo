define(["underscore.custom","marionette.custom","views/common/empty"],function(e,t,n){var r=t.CollectionView.extend({events:{"click .js-load-more":"onClickLoadMore"},emptyView:n,modelData:{},data:{},fetchMethod:"fetch",template:function(){return e.template('<div class="js-entries"></div><div><button autocomplete="off" class="btn btn-primary btn-sm js-load-more form-control"><%= _.t("Load More") %></button></div>')},onBeforeRender:function(){this.$el.html(this.template());var e=this.collection.size(),t=this.collection.getLimit();e<t&&this.$(".js-load-more").hide()},appendHtml:function(e,t,n){e.isBuffering?e.elBuffer.appendChild(t.el):e.$(".js-entries").append(t.el)},appendBuffer:function(e,t){e.$(".js-entries").append(t)},_constructRequestData:function(n){var r=t.getOption(this,"modelData");e.each(r,function(e,t){n[t]=this.model.get(e)},this);var i=t.getOption(this,"data");return e.each(i,function(e,t){n[t]=e}),n},fetchCollection:function(e){var n=this;e=e||{},e.data=e.data||{},this._constructRequestData(e.data);var r=t.getOption(this,"fetchMethod");return this.collection[r](e).success(function(e){n.triggerMethod("fetch",e)})},onClickLoadMore:function(e){var t=this,n=$(e.currentTarget);n.bsbutton("loading");var r=this.collection,i=r.getOffset(),s=r.getLimit(),o=i+s;this.fetchCollection({add:!0,remove:!1,data:{offset:o,limit:s}}).complete(function(){var e=t.collection.pagination.offset-t.collection.pagination.total>=0,r=t.collection.getOffset()+t.collection.getLimit();e=e||r>t.collection.pagination.total,n.bsbutton("reset"),e&&n.hide()}).error(function(){})},onRefresh:function(){this.$(".js-load-more").show(),this.fetchCollection({reset:!0})}});return r});