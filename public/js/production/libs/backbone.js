define(["underscore","backbone","vendors/backbone.supermodel","vendors/arrg","vendors/jquery.noty","vendors/jquery.noty.top","vendors/jquery.noty.bootstrap"],function(e,t,n,r,i){t.SuperModel=n,t.arrg=r,t.showAlert=function(t,n){if(e.isArray(n)){var r=[];e.each(n,function(t){e.isString(t)?r.push(t):(t=e.values(t),t=e.flatten(t),r=e.union(r,t))}),n=r.join("<br/>")}else if(e.isObject(n)){var s=e.values(n);s=e.flatten(s),n=s.join("<br/>")}var o={text:n,type:t,timeout:2e3,layout:"top"};i(o)},t.Dispatch=e.extend({},t.Events),t.Dispatch.on("error",function(e){t.showAlert("error",e)}),t.Dispatch.on("success",function(e){t.showAlert("success",e)}),t.Dispatch.on("unauthorizeAccess",function(e){$("#login-dialog").modal({backdrop:"static"})});var s={create:"POST",update:"POST","delete":"POST",read:"GET",list:"GET"},o="/api";return t.apiPrefix=o,t.wrapError=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}},t.sync=function(n,r,i){var o=s[n];e.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var u={type:o,dataType:"json"};i.url||(u.url=e.result(r,"url"));if(!u.url)throw"URL is not defined";u.url="/"+u.url+"/"+n,i.data!=null||!r||n!=="create"&&n!=="update"&&n!=="patch"&&n!=="delete"?u.data=i.data:(u.contentType="application/json",u.data=i.attrs||r.toJSON(i)),u.type!=="GET"&&!i.emulateJSON&&(u.processData=!1);var a=i.xhr=t.callApi(u.type,u.url,u.data,i);return r.trigger("request",r,a,i),a},t.parseApiError=function(t){try{var n=JSON.parse(t.responseText).error;return n}catch(r){return{type:"NETWORK_ERROR",messages:e.t("Network Error")}}},t.callApi=function(n,r,i,s){n=n.toLowerCase(),i=i||{},s=s||{},r.charAt(0)!="/"&&(r="/"+r),r=o+r;var u=e.extend({type:n,url:r,dataType:"json"},s);n=="post"?(u.contentType="application/json",u.data=JSON.stringify(i)):u.data=i;var a=$.ajax(u);return s.customError||a.error(function(e){var n=t.parseApiError(e);n.type=="UNAUTHORIZED_ACCESS"&&t.Dispatch.trigger("unauthorizeAccess"),t.Dispatch.trigger("error",n.messages)}),a.success(function(e){e.alert&&t.Dispatch.trigger(e.alert.type,e.alert.messages),e.redirect&&setTimeout(function(){window.location.href=e.redirect},2e3)}),a},t});